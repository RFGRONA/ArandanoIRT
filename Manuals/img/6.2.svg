<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="712px" preserveAspectRatio="none" style="width:1244px;height:712px;background:#FFFFFF;" version="1.1" viewBox="0 0 1244 712" width="1244px" zoomAndPan="magnify"><title>6.2: Flujo de Envío de Datos</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="221.334" x="510.4553" y="27.9951">6.2: Flujo de Envío de Datos</text><g><title>DeviceAuthHandler</title><rect fill="#FFFFFF" height="71.2656" style="stroke:#181818;stroke-width:1;" width="10" x="138.7871" y="164.8594"/></g><g><title>DeviceApiController</title><rect fill="#FFFFFF" height="377.5938" style="stroke:#181818;stroke-width:1;" width="10" x="374.5537" y="236.125"/></g><g><title>IDataSubmissionService</title><rect fill="#FFFFFF" height="277.1953" style="stroke:#181818;stroke-width:1;" width="10" x="657.2949" y="307.3906"/></g><g><title>IWeatherService</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="910.5767" y="336.5234"/></g><g><title>IFileStorageService</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="1059.9409" y="418.9219"/></g><g><title>DbContext</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="1188.8657" y="526.3203"/></g><rect fill="none" height="75.3984" style="stroke:#000000;stroke-width:1.5;" width="588.8857" x="560.6011" y="380.6563"/><g><title>Device</title><rect fill="#000000" fill-opacity="0.00000" height="513.125" width="8" x="27.9395" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="31" x2="31" y1="118.5938" y2="631.7188"/></g><g><title>DeviceAuthHandler</title><rect fill="#000000" fill-opacity="0.00000" height="513.125" width="8" x="139.7871" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="142.8789" x2="142.8789" y1="118.5938" y2="631.7188"/></g><g><title>DeviceApiController</title><rect fill="#000000" fill-opacity="0.00000" height="513.125" width="8" x="375.5537" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="378.8511" x2="378.8511" y1="118.5938" y2="631.7188"/></g><g><title>IDataSubmissionService</title><rect fill="#000000" fill-opacity="0.00000" height="513.125" width="8" x="658.2949" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="661.6011" x2="661.6011" y1="118.5938" y2="631.7188"/></g><g><title>IWeatherService</title><rect fill="#000000" fill-opacity="0.00000" height="513.125" width="8" x="911.5767" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="914.7583" x2="914.7583" y1="118.5938" y2="631.7188"/></g><g><title>IFileStorageService</title><rect fill="#000000" fill-opacity="0.00000" height="513.125" width="8" x="1060.9409" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1064.395" x2="1064.395" y1="118.5938" y2="631.7188"/></g><g><title>DbContext</title><rect fill="#000000" fill-opacity="0.00000" height="513.125" width="8" x="1189.8657" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1193.4868" x2="1193.4868" y1="118.5938" y2="631.7188"/></g><g class="participant participant-head" data-participant="D"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47.8789" x="5" y="115.292">Device</text><ellipse cx="31.9395" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M31.9395,58.7969 L31.9395,85.7969 M18.9395,66.7969 L44.9395,66.7969 M31.9395,85.7969 L18.9395,100.7969 M31.9395,85.7969 L44.9395,100.7969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="D"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47.8789" x="5" y="643.7139">Device</text><ellipse cx="31.9395" cy="655.5156" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M31.9395,663.5156 L31.9395,690.5156 M18.9395,671.5156 L44.9395,671.5156 M31.9395,690.5156 L18.9395,705.5156 M31.9395,690.5156 L44.9395,705.5156" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="AuthMw"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="149.8164" x="68.8789" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135.8164" x="75.8789" y="107.292">DeviceAuthHandler</text></g><g class="participant participant-tail" data-participant="AuthMw"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="149.8164" x="68.8789" y="630.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135.8164" x="75.8789" y="650.7139">DeviceAuthHandler</text></g><g class="participant participant-head" data-participant="Ctrl"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153.4053" x="302.8511" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139.4053" x="309.8511" y="107.292">DeviceApiController</text></g><g class="participant participant-tail" data-participant="Ctrl"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="153.4053" x="302.8511" y="630.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139.4053" x="309.8511" y="650.7139">DeviceApiController</text></g><g class="participant participant-head" data-participant="DataSvc"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="183.3877" x="570.6011" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="169.3877" x="577.6011" y="107.292">IDataSubmissionService</text></g><g class="participant participant-tail" data-participant="DataSvc"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="183.3877" x="570.6011" y="630.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="169.3877" x="577.6011" y="650.7139">IDataSubmissionService</text></g><g class="participant participant-head" data-participant="WeatherSvc"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="129.6367" x="850.7583" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115.6367" x="857.7583" y="107.292">IWeatherService</text></g><g class="participant participant-tail" data-participant="WeatherSvc"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="129.6367" x="850.7583" y="630.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115.6367" x="857.7583" y="650.7139">IWeatherService</text></g><g class="participant participant-head" data-participant="MinioSvc"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="149.0918" x="990.395" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135.0918" x="997.395" y="107.292">IFileStorageService</text></g><g class="participant participant-tail" data-participant="MinioSvc"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="149.0918" x="990.395" y="630.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="135.0918" x="997.395" y="650.7139">IFileStorageService</text></g><g class="participant participant-head" data-participant="DB"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="88.7578" x="1149.4868" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74.7578" x="1156.4868" y="107.292">DbContext</text></g><g class="participant participant-tail" data-participant="DB"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="88.7578" x="1149.4868" y="630.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74.7578" x="1156.4868" y="650.7139">DbContext</text></g><g><title>DeviceAuthHandler</title><rect fill="#FFFFFF" height="71.2656" style="stroke:#181818;stroke-width:1;" width="10" x="138.7871" y="164.8594"/></g><g><title>DeviceApiController</title><rect fill="#FFFFFF" height="377.5938" style="stroke:#181818;stroke-width:1;" width="10" x="374.5537" y="236.125"/></g><g><title>IDataSubmissionService</title><rect fill="#FFFFFF" height="277.1953" style="stroke:#181818;stroke-width:1;" width="10" x="657.2949" y="307.3906"/></g><g><title>IWeatherService</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="910.5767" y="336.5234"/></g><g><title>IFileStorageService</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="1059.9409" y="418.9219"/></g><g><title>DbContext</title><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1;" width="10" x="1188.8657" y="526.3203"/></g><g class="message" data-participant-1="D" data-participant-2="Ctrl"><polygon fill="#181818" points="367.5537,160.8594,377.5537,164.8594,367.5537,168.8594,371.5537,164.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="31.9395" x2="373.5537" y1="164.8594" y2="164.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130.5776" x="38.9395" y="144.6606">POST /ambient-data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212.9194" x="38.9395" y="159.7935">(Authorization: Device &lt;token&gt;)</text></g><g class="message" data-participant-1="AuthMw" data-participant-2="AuthMw"><line style="stroke:#181818;stroke-width:1;" x1="148.7871" x2="190.7871" y1="193.9922" y2="193.9922"/><line style="stroke:#181818;stroke-width:1;" x1="190.7871" x2="190.7871" y1="193.9922" y2="206.9922"/><line style="stroke:#181818;stroke-width:1;" x1="149.7871" x2="190.7871" y1="206.9922" y2="206.9922"/><polygon fill="#181818" points="159.7871,202.9922,149.7871,206.9922,159.7871,210.9922,155.7871,206.9922" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201.7666" x="155.7871" y="188.9263">Validar token y crear identidad</text></g><g class="message" data-participant-1="AuthMw" data-participant-2="Ctrl"><polygon fill="#181818" points="362.5537,232.125,372.5537,236.125,362.5537,240.125,366.5537,236.125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="143.7871" x2="368.5537" y1="236.125" y2="236.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124.8521" x="150.7871" y="231.0591">Petición autorizada</text></g><g class="message" data-participant-1="Ctrl" data-participant-2="Ctrl"><line style="stroke:#181818;stroke-width:1;" x1="384.5537" x2="426.5537" y1="265.2578" y2="265.2578"/><line style="stroke:#181818;stroke-width:1;" x1="426.5537" x2="426.5537" y1="265.2578" y2="278.2578"/><line style="stroke:#181818;stroke-width:1;" x1="385.5537" x2="426.5537" y1="278.2578" y2="278.2578"/><polygon fill="#181818" points="395.5537,274.2578,385.5537,278.2578,395.5537,282.2578,391.5537,278.2578" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197.228" x="391.5537" y="260.1919">Extraer DeviceIdentityContext</text></g><g class="message" data-participant-1="Ctrl" data-participant-2="DataSvc"><polygon fill="#181818" points="645.2949,303.3906,655.2949,307.3906,645.2949,311.3906,649.2949,307.3906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="384.5537" x2="651.2949" y1="307.3906" y2="307.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253.7412" x="391.5537" y="302.3247">SaveAmbientDataAsync(data, identity)</text></g><g class="message" data-participant-1="DataSvc" data-participant-2="WeatherSvc"><polygon fill="#181818" points="898.5767,332.5234,908.5767,336.5234,898.5767,340.5234,902.5767,336.5234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="667.2949" x2="904.5767" y1="336.5234" y2="336.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="224.2817" x="674.2949" y="331.4575">Obtener datos climáticos externos</text></g><g class="message" data-participant-1="WeatherSvc" data-participant-2="DataSvc"><polygon fill="#181818" points="678.2949,361.6563,668.2949,365.6563,678.2949,369.6563,674.2949,365.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="672.2949" x2="914.5767" y1="365.6563" y2="365.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100.9277" x="684.2949" y="360.5903">Datos del clima</text></g><path d="M560.6011,380.6563 L630.0522,380.6563 L630.0522,387.7891 L620.0522,397.7891 L560.6011,397.7891 L560.6011,380.6563" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="75.3984" style="stroke:#000000;stroke-width:1.5;" width="588.8857" x="560.6011" y="380.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="24.4512" x="575.6011" y="393.7231">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="237.4561" x="645.0522" y="392.8667">[Si es captura con imagen y es de día]</text><g class="message" data-participant-1="DataSvc" data-participant-2="MinioSvc"><polygon fill="#181818" points="1047.9409,414.9219,1057.9409,418.9219,1047.9409,422.9219,1051.9409,418.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="667.2949" x2="1053.9409" y1="418.9219" y2="418.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="139.9277" x="674.2949" y="413.856">Subir imagen a MinIO</text></g><g class="message" data-participant-1="MinioSvc" data-participant-2="DataSvc"><polygon fill="#181818" points="678.2949,444.0547,668.2949,448.0547,678.2949,452.0547,674.2949,448.0547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="672.2949" x2="1063.9409" y1="448.0547" y2="448.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114.7466" x="684.2949" y="442.9888">URL de la imagen</text></g><g class="message" data-participant-1="DataSvc" data-participant-2="DataSvc"><line style="stroke:#181818;stroke-width:1;" x1="667.2949" x2="709.2949" y1="484.1875" y2="484.1875"/><line style="stroke:#181818;stroke-width:1;" x1="709.2949" x2="709.2949" y1="484.1875" y2="497.1875"/><line style="stroke:#181818;stroke-width:1;" x1="668.2949" x2="709.2949" y1="497.1875" y2="497.1875"/><polygon fill="#181818" points="678.2949,493.1875,668.2949,497.1875,678.2949,501.1875,674.2949,497.1875" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145.3677" x="674.2949" y="479.1216">Construir entidad final</text></g><g class="message" data-participant-1="DataSvc" data-participant-2="DB"><polygon fill="#181818" points="1176.8657,522.3203,1186.8657,526.3203,1176.8657,530.3203,1180.8657,526.3203" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="667.2949" x2="1182.8657" y1="526.3203" y2="526.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="270.1943" x="674.2949" y="521.2544">Guardar registro (EnvironmentalReading)</text></g><g class="message" data-participant-1="DB" data-participant-2="DataSvc"><polygon fill="#181818" points="678.2949,551.4531,668.2949,555.4531,678.2949,559.4531,674.2949,555.4531" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="672.2949" x2="1192.8657" y1="555.4531" y2="555.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86.3853" x="684.2949" y="550.3872">Confirmación</text></g><g class="message" data-participant-1="DataSvc" data-participant-2="Ctrl"><polygon fill="#181818" points="395.5537,580.5859,385.5537,584.5859,395.5537,588.5859,391.5537,584.5859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="389.5537" x2="661.2949" y1="584.5859" y2="584.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27.5107" x="401.5537" y="579.52">void</text></g><g class="message" data-participant-1="Ctrl" data-participant-2="D"><polygon fill="#181818" points="42.9395,609.7188,32.9395,613.7188,42.9395,617.7188,38.9395,613.7188" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="36.9395" x2="378.5537" y1="613.7188" y2="613.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108.4688" x="48.9395" y="608.6528">NoContent (204)</text></g><!--SRC=[RLDBRjim4Dth58Ei7A1kYw3eGYW2s57I6cZg8kfdqyrOd3ZJqgH1KMxSs_G0MUK8lbY7rCTKKYqaVjxCUpFpvDbhWhSlptAuqirF2uhWqkmE3t5LeBTrbc7bhOE2TbmHO0r5jaNdkU8j6WydxSMiyNSVq2XDxYI0mlxwzt-HMxwmnZkhU-o5TtgCN0WrbirgmtNDrfJaGcG4nvjTzGJ_dT3VaKk1_T4px1LhAgKaN5EAlsR3zXcwM0MnTEzRydcM5J0zZv9p-Bmily0htAoOZ9ygKVR3J4Bbrl4VzA8yx_lspjjVPCvFGpTvXvxw3hMVaBDTvV0DDIjq42DW3vKZsR4I3ZbNIKIdWeBSmwC1R7naLfWfUaeqx6Exm-kOulBUEwH-o8j8vVTTvGEsQtqE9UverbOTpcRrtbIJKFwBJgRV9uNs4-k-8TDnDZaiLvwCSAlWDgWqRmv_fI1P2pSv8nOSKYKpFIvXccgBfXNtwfXgr8Wascuzb0maXBZrZKEeh071hsFBAMG0TNZ03EH9bFSkaIOqAtPz28QBnJAY1xx1KU6qtupLVhtv69WqTeaYD94yf22ZqWOE2MH6jNUDAEdi0RTiK8-mynpUD-Y2fnojMV0M9lARixDc8s6eRmWLctKwj7bMpCTQXUgMtGQZrzA-1cnFDrXgPrcDG9qBMZE5l3byij5YyfzDpbw_EKtX0VOF]--></g></svg>