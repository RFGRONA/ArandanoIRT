<!-- HTML header for doxygen 1.10.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ArandanoIRT Backend: ArandanoIRT_Backend.Infrastructure.Services.JwtTokenService Class Reference</title>
<link rel="icon" href="logo.svg" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
    // Llama a .init() para otros scripts que hayas a√±adido y que lo requieran
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ArandanoIRT Backend<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('class_arandano_i_r_t___backend_1_1_infrastructure_1_1_services_1_1_jwt_token_service.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="class_arandano_i_r_t___backend_1_1_infrastructure_1_1_services_1_1_jwt_token_service-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">ArandanoIRT_Backend.Infrastructure.Services.JwtTokenService Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Implements the ITokenService interface, providing services for generating, validating, refreshing, and revoking JWT access tokens and database-backed opaque refresh tokens.  
 <a href="#details">More...</a></p>
<div class="dynheader">
Inheritance diagram for ArandanoIRT_Backend.Infrastructure.Services.JwtTokenService:</div>
<div class="dyncontent">
<div class="center"><img src="class_arandano_i_r_t___backend_1_1_infrastructure_1_1_services_1_1_jwt_token_service__inherit__graph.png" border="0" usemap="#a_arandano_i_r_t___backend_8_infrastructure_8_services_8_jwt_token_service_inherit__map" alt="Inheritance graph"/></div>
<map name="a_arandano_i_r_t___backend_8_infrastructure_8_services_8_jwt_token_service_inherit__map" id="a_arandano_i_r_t___backend_8_infrastructure_8_services_8_jwt_token_service_inherit__map">
<area shape="rect" title="Implements the ITokenService interface, providing services for generating, validating,..." alt="" coords="5,251,235,485"/>
<area shape="rect" href="interface_arandano_i_r_t___backend_1_1_infrastructure_1_1_interfaces_1_1_i_services_1_1_i_token_service.html" title="Defines a contract for services responsible for handling the lifecycle of authentication tokens,..." alt="" coords="11,5,229,203"/>
<area shape="poly" title=" " alt="" coords="123,218,123,251,118,251,118,218"/>
</map>
</div>
<div class="dynheader">
Collaboration diagram for ArandanoIRT_Backend.Infrastructure.Services.JwtTokenService:</div>
<div class="dyncontent">
<div class="center"><img src="class_arandano_i_r_t___backend_1_1_infrastructure_1_1_services_1_1_jwt_token_service__coll__graph.png" border="0" usemap="#a_arandano_i_r_t___backend_8_infrastructure_8_services_8_jwt_token_service_coll__map" alt="Collaboration graph"/></div>
<map name="a_arandano_i_r_t___backend_8_infrastructure_8_services_8_jwt_token_service_coll__map" id="a_arandano_i_r_t___backend_8_infrastructure_8_services_8_jwt_token_service_coll__map">
<area shape="rect" title="Implements the ITokenService interface, providing services for generating, validating,..." alt="" coords="5,251,235,485"/>
<area shape="rect" href="interface_arandano_i_r_t___backend_1_1_infrastructure_1_1_interfaces_1_1_i_services_1_1_i_token_service.html" title="Defines a contract for services responsible for handling the lifecycle of authentication tokens,..." alt="" coords="11,5,229,203"/>
<area shape="poly" title=" " alt="" coords="123,218,123,251,118,251,118,218"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a6b31505c8e03a592124cbfb9ecef3410" id="r_a6b31505c8e03a592124cbfb9ecef3410"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6b31505c8e03a592124cbfb9ecef3410">JwtTokenService</a> (IConfiguration configuration, <a class="el" href="interface_arandano_i_r_t___backend_1_1_domain_1_1_i_repositories_1_1_i_refresh_token_repository.html">IRefreshTokenRepository</a> refreshTokenRepository, <a class="el" href="interface_arandano_i_r_t___backend_1_1_application_1_1_interfaces_1_1_utilities_1_1_i_date_time_provider.html">IDateTimeProvider</a> dateTimeProvider, <a class="el" href="interface_arandano_i_r_t___backend_1_1_domain_1_1_i_repositories_1_1_i_person_repository.html">IPersonRepository</a> personRepository, ILogger&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_infrastructure_1_1_services_1_1_jwt_token_service.html">JwtTokenService</a> &gt; logger)</td></tr>
<tr class="memdesc:a6b31505c8e03a592124cbfb9ecef3410"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes a new instance of the JwtTokenService class.  <br /></td></tr>
<tr class="separator:a6b31505c8e03a592124cbfb9ecef3410"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51f95726b9f0a86dd87ab866a783b984" id="r_a51f95726b9f0a86dd87ab866a783b984"><td class="memItemLeft" align="right" valign="top">async Task&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_domain_1_1_value_objects_1_1_result.html">Result</a>&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_application_1_1_d_t_os_1_1_auth_1_1_token_response_dto.html">TokenResponseDto</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a51f95726b9f0a86dd87ab866a783b984">GenerateAndStoreTokensAsync</a> (<a class="el" href="class_arandano_i_r_t___backend_1_1_domain_1_1_entities_1_1_person_entity.html">PersonEntity</a> person, string ipAddress, string userAgent)</td></tr>
<tr class="memdesc:a51f95726b9f0a86dd87ab866a783b984"><td class="mdescLeft">&#160;</td><td class="mdescRight">Asynchronously generates a new set of access and refresh tokens for a specified user.Creates and stores the refresh token information (including IP, UserAgent) in the database. Device information will be stored as null or default.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">person</td><td>The PersonEntity for whom to generate tokens.</td></tr>
    <tr><td class="paramname">ipAddress</td><td>The IP address of the client requesting the tokens.</td></tr>
    <tr><td class="paramname">userAgent</td><td>The user agent string of the client requesting the tokens.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A Task&lt;TResult&gt; containing a Result&lt;T&gt; with a TokenResponseDto if successful, or failure otherwise. </dd></dl>
  <br /></td></tr>
<tr class="separator:a51f95726b9f0a86dd87ab866a783b984"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85b39b665dac048173084033325ebe0b" id="r_a85b39b665dac048173084033325ebe0b"><td class="memItemLeft" align="right" valign="top">async Task&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_domain_1_1_value_objects_1_1_result.html">Result</a>&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_application_1_1_d_t_os_1_1_auth_1_1_token_response_dto.html">TokenResponseDto</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a85b39b665dac048173084033325ebe0b">GenerateAndStoreTokensAsync</a> (<a class="el" href="class_arandano_i_r_t___backend_1_1_domain_1_1_entities_1_1_person_entity.html">PersonEntity</a> person, string ipAddress, string userAgent, string? deviceInfo)</td></tr>
<tr class="memdesc:a85b39b665dac048173084033325ebe0b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Asynchronously generates a new set of access and refresh tokens for a specified user.Creates and stores the refresh token information (including IP, UserAgent, and device info) in the database.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">person</td><td>The PersonEntity for whom to generate tokens.</td></tr>
    <tr><td class="paramname">ipAddress</td><td>The IP address of the client requesting the tokens.</td></tr>
    <tr><td class="paramname">userAgent</td><td>The user agent string of the client requesting the tokens.</td></tr>
    <tr><td class="paramname">deviceInfo</td><td>Optional descriptive information about the client device.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A Task&lt;TResult&gt; containing a Result&lt;T&gt; with a TokenResponseDto if successful, or failure otherwise. </dd></dl>
  <br /></td></tr>
<tr class="separator:a85b39b665dac048173084033325ebe0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba1da209a50b161b984add1b40f753fc" id="r_aba1da209a50b161b984add1b40f753fc"><td class="memItemLeft" align="right" valign="top">async Task&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_domain_1_1_value_objects_1_1_result.html">Result</a>&lt; long &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aba1da209a50b161b984add1b40f753fc">GetSessionIdFromTokenAsync</a> (string refreshTokenValue)</td></tr>
<tr class="memdesc:aba1da209a50b161b984add1b40f753fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Asynchronously retrieves the session identifier associated with a given refresh token string from the database.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">refreshTokenValue</td><td>The opaque refresh token string.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A Task&lt;TResult&gt; representing the asynchronous operation, containing a Result&lt;T&gt; which holds the session ID (<code>long</code>) if the token is found and active, or a failure result otherwise. </dd></dl>
  <br /></td></tr>
<tr class="separator:aba1da209a50b161b984add1b40f753fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf9365ba5bea011ad8cdf4ad2bac4aa2" id="r_aaf9365ba5bea011ad8cdf4ad2bac4aa2"><td class="memItemLeft" align="right" valign="top">async Task&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_domain_1_1_value_objects_1_1_result.html">Result</a>&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_application_1_1_d_t_os_1_1_auth_1_1_token_response_dto.html">TokenResponseDto</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aaf9365ba5bea011ad8cdf4ad2bac4aa2">RefreshTokensAsync</a> (string refreshTokenValue, string ipAddress, string userAgent)</td></tr>
<tr class="memdesc:aaf9365ba5bea011ad8cdf4ad2bac4aa2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Asynchronously validates a provided refresh token, generates new tokens, revokes the old one (Token Rotation), and stores the new refresh token information.Device information will be stored as null or default.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">refreshTokenValue</td><td>The opaque refresh token string provided by the client.</td></tr>
    <tr><td class="paramname">ipAddress</td><td>The IP address of the client making the refresh request.</td></tr>
    <tr><td class="paramname">userAgent</td><td>The user agent string of the client making the refresh request.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A Task&lt;TResult&gt; containing a Result&lt;T&gt; with a new TokenResponseDto if successful, or failure otherwise. </dd></dl>
  <br /></td></tr>
<tr class="separator:aaf9365ba5bea011ad8cdf4ad2bac4aa2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28aff77a11d74d0edcd57294e06491bd" id="r_a28aff77a11d74d0edcd57294e06491bd"><td class="memItemLeft" align="right" valign="top">async Task&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_domain_1_1_value_objects_1_1_result.html">Result</a>&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_application_1_1_d_t_os_1_1_auth_1_1_token_response_dto.html">TokenResponseDto</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a28aff77a11d74d0edcd57294e06491bd">RefreshTokensAsync</a> (string refreshTokenValue, string ipAddress, string userAgent, string? deviceInfo)</td></tr>
<tr class="memdesc:a28aff77a11d74d0edcd57294e06491bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Asynchronously validates a provided refresh token, generates new tokens, revokes the old one (Token Rotation), and stores the new refresh token information including device info.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">refreshTokenValue</td><td>The opaque refresh token string provided by the client.</td></tr>
    <tr><td class="paramname">ipAddress</td><td>The IP address of the client making the refresh request.</td></tr>
    <tr><td class="paramname">userAgent</td><td>The user agent string of the client making the refresh request.</td></tr>
    <tr><td class="paramname">deviceInfo</td><td>Optional descriptive information about the client device making the refresh request.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A Task&lt;TResult&gt; containing a Result&lt;T&gt; with a new TokenResponseDto if successful, or failure otherwise. </dd></dl>
  <br /></td></tr>
<tr class="separator:a28aff77a11d74d0edcd57294e06491bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01405e583cbb80ca876250a8ef456c5b" id="r_a01405e583cbb80ca876250a8ef456c5b"><td class="memItemLeft" align="right" valign="top">async Task&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_domain_1_1_value_objects_1_1_result.html">Result</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a01405e583cbb80ca876250a8ef456c5b">RevokeRefreshTokenAsync</a> (string refreshTokenValue, string ipAddress)</td></tr>
<tr class="memdesc:a01405e583cbb80ca876250a8ef456c5b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Asynchronously revokes a specific refresh token stored in the database, marking it as invalid.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">refreshTokenValue</td><td>The opaque refresh token string to revoke.</td></tr>
    <tr><td class="paramname">ipAddress</td><td>The IP address initiating the revocation action (for auditing purposes).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A Task&lt;TResult&gt; representing the asynchronous operation, containing a Result indicating success or failure of the revocation operation. </dd></dl>
  <br /></td></tr>
<tr class="separator:a01405e583cbb80ca876250a8ef456c5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0104c282537d020e320af96ec964c89" id="r_aa0104c282537d020e320af96ec964c89"><td class="memItemLeft" align="right" valign="top">ClaimsPrincipal?&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa0104c282537d020e320af96ec964c89">GetPrincipalFromExpiredToken</a> (string token)</td></tr>
<tr class="memdesc:aa0104c282537d020e320af96ec964c89"><td class="mdescLeft">&#160;</td><td class="mdescRight">Attempts to extract the claims principal from a JWT access token string, potentially ignoring lifetime validation (allowing expired tokens to be read) but still validating the signature.Useful for retrieving user information from an expired token during the refresh process.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">token</td><td>The JWT access token string (can be expired but must be well-formed and have a valid signature).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The ClaimsPrincipal extracted from the token if parsing and signature validation succeed; otherwise, <code>null</code>. </dd></dl>
  <br /></td></tr>
<tr class="separator:aa0104c282537d020e320af96ec964c89"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implements the ITokenService interface, providing services for generating, validating, refreshing, and revoking JWT access tokens and database-backed opaque refresh tokens. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a6b31505c8e03a592124cbfb9ecef3410" name="a6b31505c8e03a592124cbfb9ecef3410"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b31505c8e03a592124cbfb9ecef3410">&#9670;&#160;</a></span>JwtTokenService()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ArandanoIRT_Backend.Infrastructure.Services.JwtTokenService.JwtTokenService </td>
          <td>(</td>
          <td class="paramtype">IConfiguration</td>          <td class="paramname"><span class="paramname"><em>configuration</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="interface_arandano_i_r_t___backend_1_1_domain_1_1_i_repositories_1_1_i_refresh_token_repository.html">IRefreshTokenRepository</a></td>          <td class="paramname"><span class="paramname"><em>refreshTokenRepository</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="interface_arandano_i_r_t___backend_1_1_application_1_1_interfaces_1_1_utilities_1_1_i_date_time_provider.html">IDateTimeProvider</a></td>          <td class="paramname"><span class="paramname"><em>dateTimeProvider</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="interface_arandano_i_r_t___backend_1_1_domain_1_1_i_repositories_1_1_i_person_repository.html">IPersonRepository</a></td>          <td class="paramname"><span class="paramname"><em>personRepository</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ILogger&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_infrastructure_1_1_services_1_1_jwt_token_service.html">JwtTokenService</a> &gt;</td>          <td class="paramname"><span class="paramname"><em>logger</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initializes a new instance of the JwtTokenService class. </p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">ArgumentNullException</td><td>Thrown if dependencies or required JWT config keys are null/missing.</td></tr>
    <tr><td class="paramname">FormatException</td><td>Thrown if JWT expiry/refresh config values cannot be parsed.</td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a51f95726b9f0a86dd87ab866a783b984" name="a51f95726b9f0a86dd87ab866a783b984"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51f95726b9f0a86dd87ab866a783b984">&#9670;&#160;</a></span>GenerateAndStoreTokensAsync() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">async Task&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_domain_1_1_value_objects_1_1_result.html">Result</a>&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_application_1_1_d_t_os_1_1_auth_1_1_token_response_dto.html">TokenResponseDto</a> &gt; &gt; ArandanoIRT_Backend.Infrastructure.Services.JwtTokenService.GenerateAndStoreTokensAsync </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_arandano_i_r_t___backend_1_1_domain_1_1_entities_1_1_person_entity.html">PersonEntity</a></td>          <td class="paramname"><span class="paramname"><em>person</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>ipAddress</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>userAgent</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Asynchronously generates a new set of access and refresh tokens for a specified user.Creates and stores the refresh token information (including IP, UserAgent) in the database. Device information will be stored as null or default.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">person</td><td>The PersonEntity for whom to generate tokens.</td></tr>
    <tr><td class="paramname">ipAddress</td><td>The IP address of the client requesting the tokens.</td></tr>
    <tr><td class="paramname">userAgent</td><td>The user agent string of the client requesting the tokens.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A Task&lt;TResult&gt; containing a Result&lt;T&gt; with a TokenResponseDto if successful, or failure otherwise. </dd></dl>
 </p>

<p>Implements <a class="el" href="interface_arandano_i_r_t___backend_1_1_infrastructure_1_1_interfaces_1_1_i_services_1_1_i_token_service.html#ae265aad34414efb49ee98abbbde2299f">ArandanoIRT_Backend.Infrastructure.Interfaces.IServices.ITokenService</a>.</p>

</div>
</div>
<a id="a85b39b665dac048173084033325ebe0b" name="a85b39b665dac048173084033325ebe0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a85b39b665dac048173084033325ebe0b">&#9670;&#160;</a></span>GenerateAndStoreTokensAsync() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">async Task&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_domain_1_1_value_objects_1_1_result.html">Result</a>&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_application_1_1_d_t_os_1_1_auth_1_1_token_response_dto.html">TokenResponseDto</a> &gt; &gt; ArandanoIRT_Backend.Infrastructure.Services.JwtTokenService.GenerateAndStoreTokensAsync </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_arandano_i_r_t___backend_1_1_domain_1_1_entities_1_1_person_entity.html">PersonEntity</a></td>          <td class="paramname"><span class="paramname"><em>person</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>ipAddress</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>userAgent</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string?</td>          <td class="paramname"><span class="paramname"><em>deviceInfo</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Asynchronously generates a new set of access and refresh tokens for a specified user.Creates and stores the refresh token information (including IP, UserAgent, and device info) in the database.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">person</td><td>The PersonEntity for whom to generate tokens.</td></tr>
    <tr><td class="paramname">ipAddress</td><td>The IP address of the client requesting the tokens.</td></tr>
    <tr><td class="paramname">userAgent</td><td>The user agent string of the client requesting the tokens.</td></tr>
    <tr><td class="paramname">deviceInfo</td><td>Optional descriptive information about the client device.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A Task&lt;TResult&gt; containing a Result&lt;T&gt; with a TokenResponseDto if successful, or failure otherwise. </dd></dl>
 </p>

<p>Implements <a class="el" href="interface_arandano_i_r_t___backend_1_1_infrastructure_1_1_interfaces_1_1_i_services_1_1_i_token_service.html#abf8d31675aa27ad405069344f786db50">ArandanoIRT_Backend.Infrastructure.Interfaces.IServices.ITokenService</a>.</p>

</div>
</div>
<a id="aa0104c282537d020e320af96ec964c89" name="aa0104c282537d020e320af96ec964c89"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0104c282537d020e320af96ec964c89">&#9670;&#160;</a></span>GetPrincipalFromExpiredToken()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ClaimsPrincipal? ArandanoIRT_Backend.Infrastructure.Services.JwtTokenService.GetPrincipalFromExpiredToken </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>token</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Attempts to extract the claims principal from a JWT access token string, potentially ignoring lifetime validation (allowing expired tokens to be read) but still validating the signature.Useful for retrieving user information from an expired token during the refresh process.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">token</td><td>The JWT access token string (can be expired but must be well-formed and have a valid signature).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The ClaimsPrincipal extracted from the token if parsing and signature validation succeed; otherwise, <code>null</code>. </dd></dl>
 </p>

<p>Implements <a class="el" href="interface_arandano_i_r_t___backend_1_1_infrastructure_1_1_interfaces_1_1_i_services_1_1_i_token_service.html#a25715959f8ae9c90e107999b3c152f24">ArandanoIRT_Backend.Infrastructure.Interfaces.IServices.ITokenService</a>.</p>

</div>
</div>
<a id="aba1da209a50b161b984add1b40f753fc" name="aba1da209a50b161b984add1b40f753fc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba1da209a50b161b984add1b40f753fc">&#9670;&#160;</a></span>GetSessionIdFromTokenAsync()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">async Task&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_domain_1_1_value_objects_1_1_result.html">Result</a>&lt; long &gt; &gt; ArandanoIRT_Backend.Infrastructure.Services.JwtTokenService.GetSessionIdFromTokenAsync </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>refreshTokenValue</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Asynchronously retrieves the session identifier associated with a given refresh token string from the database.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">refreshTokenValue</td><td>The opaque refresh token string.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A Task&lt;TResult&gt; representing the asynchronous operation, containing a Result&lt;T&gt; which holds the session ID (<code>long</code>) if the token is found and active, or a failure result otherwise. </dd></dl>
 </p>

<p>Implements <a class="el" href="interface_arandano_i_r_t___backend_1_1_infrastructure_1_1_interfaces_1_1_i_services_1_1_i_token_service.html#a8dbd0140ab95d3e72a082cca644b003e">ArandanoIRT_Backend.Infrastructure.Interfaces.IServices.ITokenService</a>.</p>

</div>
</div>
<a id="aaf9365ba5bea011ad8cdf4ad2bac4aa2" name="aaf9365ba5bea011ad8cdf4ad2bac4aa2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf9365ba5bea011ad8cdf4ad2bac4aa2">&#9670;&#160;</a></span>RefreshTokensAsync() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">async Task&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_domain_1_1_value_objects_1_1_result.html">Result</a>&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_application_1_1_d_t_os_1_1_auth_1_1_token_response_dto.html">TokenResponseDto</a> &gt; &gt; ArandanoIRT_Backend.Infrastructure.Services.JwtTokenService.RefreshTokensAsync </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>refreshTokenValue</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>ipAddress</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>userAgent</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Asynchronously validates a provided refresh token, generates new tokens, revokes the old one (Token Rotation), and stores the new refresh token information.Device information will be stored as null or default.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">refreshTokenValue</td><td>The opaque refresh token string provided by the client.</td></tr>
    <tr><td class="paramname">ipAddress</td><td>The IP address of the client making the refresh request.</td></tr>
    <tr><td class="paramname">userAgent</td><td>The user agent string of the client making the refresh request.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A Task&lt;TResult&gt; containing a Result&lt;T&gt; with a new TokenResponseDto if successful, or failure otherwise. </dd></dl>
 </p>

<p>Implements <a class="el" href="interface_arandano_i_r_t___backend_1_1_infrastructure_1_1_interfaces_1_1_i_services_1_1_i_token_service.html#abb8e4d63c85b84543eeba38391bf9017">ArandanoIRT_Backend.Infrastructure.Interfaces.IServices.ITokenService</a>.</p>

</div>
</div>
<a id="a28aff77a11d74d0edcd57294e06491bd" name="a28aff77a11d74d0edcd57294e06491bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28aff77a11d74d0edcd57294e06491bd">&#9670;&#160;</a></span>RefreshTokensAsync() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">async Task&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_domain_1_1_value_objects_1_1_result.html">Result</a>&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_application_1_1_d_t_os_1_1_auth_1_1_token_response_dto.html">TokenResponseDto</a> &gt; &gt; ArandanoIRT_Backend.Infrastructure.Services.JwtTokenService.RefreshTokensAsync </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>refreshTokenValue</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>ipAddress</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>userAgent</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string?</td>          <td class="paramname"><span class="paramname"><em>deviceInfo</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Asynchronously validates a provided refresh token, generates new tokens, revokes the old one (Token Rotation), and stores the new refresh token information including device info.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">refreshTokenValue</td><td>The opaque refresh token string provided by the client.</td></tr>
    <tr><td class="paramname">ipAddress</td><td>The IP address of the client making the refresh request.</td></tr>
    <tr><td class="paramname">userAgent</td><td>The user agent string of the client making the refresh request.</td></tr>
    <tr><td class="paramname">deviceInfo</td><td>Optional descriptive information about the client device making the refresh request.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A Task&lt;TResult&gt; containing a Result&lt;T&gt; with a new TokenResponseDto if successful, or failure otherwise. </dd></dl>
 </p>

<p>Implements <a class="el" href="interface_arandano_i_r_t___backend_1_1_infrastructure_1_1_interfaces_1_1_i_services_1_1_i_token_service.html#aa9628293c55dfab43c47d288bcbbdffe">ArandanoIRT_Backend.Infrastructure.Interfaces.IServices.ITokenService</a>.</p>

</div>
</div>
<a id="a01405e583cbb80ca876250a8ef456c5b" name="a01405e583cbb80ca876250a8ef456c5b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01405e583cbb80ca876250a8ef456c5b">&#9670;&#160;</a></span>RevokeRefreshTokenAsync()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">async Task&lt; <a class="el" href="class_arandano_i_r_t___backend_1_1_domain_1_1_value_objects_1_1_result.html">Result</a> &gt; ArandanoIRT_Backend.Infrastructure.Services.JwtTokenService.RevokeRefreshTokenAsync </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>refreshTokenValue</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>ipAddress</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Asynchronously revokes a specific refresh token stored in the database, marking it as invalid.<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">refreshTokenValue</td><td>The opaque refresh token string to revoke.</td></tr>
    <tr><td class="paramname">ipAddress</td><td>The IP address initiating the revocation action (for auditing purposes).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A Task&lt;TResult&gt; representing the asynchronous operation, containing a Result indicating success or failure of the revocation operation. </dd></dl>
 </p>

<p>Implements <a class="el" href="interface_arandano_i_r_t___backend_1_1_infrastructure_1_1_interfaces_1_1_i_services_1_1_i_token_service.html#a1c07b1d9e195cc7a59fd36fcf64d8c1d">ArandanoIRT_Backend.Infrastructure.Interfaces.IServices.ITokenService</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>Infrastructure/Services/<a class="el" href="_jwt_token_service_8cs.html">JwtTokenService.cs</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespace_arandano_i_r_t___backend.html">ArandanoIRT_Backend</a></li><li class="navelem"><a class="el" href="namespace_arandano_i_r_t___backend_1_1_infrastructure.html">Infrastructure</a></li><li class="navelem"><a class="el" href="namespace_arandano_i_r_t___backend_1_1_infrastructure_1_1_services.html">Services</a></li><li class="navelem"><a class="el" href="class_arandano_i_r_t___backend_1_1_infrastructure_1_1_services_1_1_jwt_token_service.html">JwtTokenService</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
