\doxysection{API Class Reference}
\hypertarget{class_a_p_i}{}\label{class_a_p_i}\index{API@{API}}


Manages device activation, authentication token retrieval, and backend status checks via HTTPS.  




{\ttfamily \#include $<$API.\+h$>$}



Collaboration diagram for API\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=197pt]{class_a_p_i__coll__graph}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_a_p_i_adb63c7166868fb7d32cd11d4a457701c}{API}} ()
\begin{DoxyCompactList}\small\item\em Constructor for the \doxylink{class_a_p_i}{API} class. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{class_a_p_i_acdcc14103bf9fb83981814d0ad5431cf}{activate\+Device}} ()
\begin{DoxyCompactList}\small\item\em Attempts to activate the device with the backend. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{class_a_p_i_ad1eb726b035fb93aff32dead3bf646fc}{check\+Activation}} ()
\begin{DoxyCompactList}\small\item\em Verifies if the device is still considered active by the backend and retrieves the auth token. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{class_a_p_i_a4b5e41385595c8b20c8de569d735cc0d}{check\+Backend\+Status}} ()
\begin{DoxyCompactList}\small\item\em Performs a simple check to see if the backend \doxylink{class_a_p_i}{API} is online and reachable. \end{DoxyCompactList}\item 
String \mbox{\hyperlink{class_a_p_i_a9f7a74880b1bbd9f0605d237c45aadd2}{get\+Auth\+Token}} ()
\begin{DoxyCompactList}\small\item\em Retrieves the currently stored authentication token. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Manages device activation, authentication token retrieval, and backend status checks via HTTPS. 

This class handles the communication with the backend \doxylink{class_a_p_i}{API} for critical operations like activating the device upon first use and periodically checking its status and retrieving authentication tokens. It uses the Preferences library to persist the activation state and the latest auth token in Non-\/\+Volatile Storage (NVS). It also uses an \doxylink{class_l_e_d_status}{LEDStatus} object to provide visual feedback on operation success or failure. \begin{DoxyNote}{Note}
This class might be under development or requires specific backend infrastructure. 
\end{DoxyNote}


\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{class_a_p_i_adb63c7166868fb7d32cd11d4a457701c}\label{class_a_p_i_adb63c7166868fb7d32cd11d4a457701c} 
\index{API@{API}!API@{API}}
\index{API@{API}!API@{API}}
\doxysubsubsection{\texorpdfstring{API()}{API()}}
{\footnotesize\ttfamily API\+::\+API (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Constructor for the \doxylink{class_a_p_i}{API} class. 

Constructor implementation.

Initializes the Preferences library namespace and loads the auth token from NVS if available. 

\doxysubsection{Member Function Documentation}
\Hypertarget{class_a_p_i_acdcc14103bf9fb83981814d0ad5431cf}\label{class_a_p_i_acdcc14103bf9fb83981814d0ad5431cf} 
\index{API@{API}!activateDevice@{activateDevice}}
\index{activateDevice@{activateDevice}!API@{API}}
\doxysubsubsection{\texorpdfstring{activateDevice()}{activateDevice()}}
{\footnotesize\ttfamily bool API\+::activate\+Device (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Attempts to activate the device with the backend. 

Implementation of the device activation logic.

Sends the predefined activation JWT to the activation endpoint. If the backend responds with HTTP 200 OK, it saves the "{}\+ACTIVATED"{} state to NVS. Otherwise, it indicates an authentication error via LED and saves "{}\+NO\+\_\+\+ACTIVATED"{} state. Includes retry logic defined by HTTP\+\_\+\+MAX\+\_\+\+RETRIES. \begin{DoxyReturn}{Returns}
true if activation was successful within retry limits, false otherwise. 
\end{DoxyReturn}
\Hypertarget{class_a_p_i_ad1eb726b035fb93aff32dead3bf646fc}\label{class_a_p_i_ad1eb726b035fb93aff32dead3bf646fc} 
\index{API@{API}!checkActivation@{checkActivation}}
\index{checkActivation@{checkActivation}!API@{API}}
\doxysubsubsection{\texorpdfstring{checkActivation()}{checkActivation()}}
{\footnotesize\ttfamily bool API\+::check\+Activation (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Verifies if the device is still considered active by the backend and retrieves the auth token. 

Implementation of the activation check and token retrieval logic.

Sends the device ID to the check activation endpoint. Expects an HTTP 200 OK response containing a JSON payload with an authentication token (e.\+g., \{"{}token"{}\+: "{}new\+\_\+token"{}\}).
\begin{DoxyItemize}
\item If a new token is received (different from the currently stored one), it\textquotesingle{}s updated both in memory and in NVS.
\item If the token is the same, no update occurs. If the response is not 200 OK or the token is missing/invalid, it indicates an authentication error via LED and saves the "{}\+NO\+\_\+\+ACTIVATED"{} state. Includes retry logic. \begin{DoxyReturn}{Returns}
true if the device is confirmed active and token handling was successful, false otherwise. 
\end{DoxyReturn}

\end{DoxyItemize}\Hypertarget{class_a_p_i_a4b5e41385595c8b20c8de569d735cc0d}\label{class_a_p_i_a4b5e41385595c8b20c8de569d735cc0d} 
\index{API@{API}!checkBackendStatus@{checkBackendStatus}}
\index{checkBackendStatus@{checkBackendStatus}!API@{API}}
\doxysubsubsection{\texorpdfstring{checkBackendStatus()}{checkBackendStatus()}}
{\footnotesize\ttfamily bool API\+::check\+Backend\+Status (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Performs a simple check to see if the backend \doxylink{class_a_p_i}{API} is online and reachable. 

Implementation of the backend status check logic.

Makes a GET request to the backend status endpoint. Considers the backend online if it receives an HTTP 200 OK response. (Optionally, could be extended to check the response body, e.\+g., \{"{}status"{}\+:"{}\+OK"{}\}). Indicates a communication error via LED on failure. \begin{DoxyReturn}{Returns}
true if the backend responded successfully (HTTP 200), false otherwise. 
\end{DoxyReturn}
\Hypertarget{class_a_p_i_a9f7a74880b1bbd9f0605d237c45aadd2}\label{class_a_p_i_a9f7a74880b1bbd9f0605d237c45aadd2} 
\index{API@{API}!getAuthToken@{getAuthToken}}
\index{getAuthToken@{getAuthToken}!API@{API}}
\doxysubsubsection{\texorpdfstring{getAuthToken()}{getAuthToken()}}
{\footnotesize\ttfamily String API\+::get\+Auth\+Token (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Retrieves the currently stored authentication token. 

Returns the current authentication token stored in memory.

Returns the token held in the volatile memory (\+\_\+auth\+Token). \begin{DoxyReturn}{Returns}
String containing the current authentication token. Might be empty if none is loaded or retrieved. 
\end{DoxyReturn}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
lib/\+API/\mbox{\hyperlink{_a_p_i_8h}{API.\+h}}\item 
lib/\+API/\mbox{\hyperlink{_a_p_i_8cpp}{API.\+cpp}}\end{DoxyCompactItemize}
